<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crozy Road: revelation</title>
    <link rel="stylesheet" href="Index.css">
</head>
<body>

    <canvas id="myCanvas" width="1500" height="880"></canvas>

    <script>
        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");

        const audio = new Audio("mario-coin.mp3");
        let juegoTerminado = false;
        let pause = false;
        let direction = "";

        class Entidad {
            constructor(x,y,w,h,c,s,vida,tipo) {
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
                this.c = c;
                this.s = s;
                this.vida = vida;
                const frameX = 16;
                const framey = 16;
            }

            estaTocando(objetivo){
                if (this.x < objetivo.x + objetivo.w && 
                    this.x + this.w > objetivo.x   &&
                    this.y < objetivo.y + objetivo.h && 
                    this.y + this.h > objetivo.y) {
                    return true;

                    //Si entidad jugador choca con enemigo pierda una vida de 3
                    if (this.tipo=="player" && objetivo.tipo=="enemy"){
                        this.vida-=1;
                        conVida();
                    }
                }
                return false;
            };

        }

        const playerSprite = new Image();
        playerSprite.src = "";

        const player = new Entidad(10,420,16,16,getRandomColor(),2,3,"player");
        const enemyTest = new Entidad(250,420,25,40,getRandomColor(),2,-1,"enemy");

        
        const image = new Image(40,40);
        image.src = "pacman.png";

        function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
        
        //var x_random = Math.floor(Math.random() * 1000);

        document.addEventListener('keydown', (e) => {

            if (pause){
                if (e.keyCode == 32){
                    pause = !pause;
                }
            }else{
                switch(e.keyCode){
                case 38:
                    direction = "up";
                    break;
                case 40:
                    direction = "down";
                    break;
                case 37:
                    direction = "left";
                    break;
                case 39:
                    direction = "right";
                    break;
                case 32:
                    pause = !pause;
                    break;
            }
            }
        });

        function update(){

            if (pause){
                //El jugador no se mueve
            }else{
                switch(direction){
                case "up":
                    player.y -= player.s;
                    if (player.y < -20){
                        player.y = 900;
                    }
                    break;
                case "down":
                    player.y += player.s;
                    if (player.y > 900){
                        player.y = -20;
                    }
                    break;
                case "left":
                    player.x -= player.s;
                    if (player.x < -20){
                        player.x = 1100;
                    }
                    break;
                case "right":
                    player.x += player.s;
                    if (player.x > 1100){
                        player.x = -20;
                    }
                    break;
                }

                //Movimiento enemigo
                enemyTest.y-=4;
                if (enemyTest.y < -20){
                    enemyTest.y = 900;
                }
            }

            

            if (player.estaTocando(enemyTest)) {
                if (player.vida === 1){
                    juegoTerminado=true;
                    console.log("El jugador perdiÃ³ todas sus vidas");
                }else{
                    console.log("Vida del jugador: "+(player.vida-1))
                    player.vida-=1;
                    player.x=10;//Reinicia la posicion del jugador
                    player.y=420;//Reinicia la posicion del jugador
                }
            }
        }

        function dibujar(){
            //Marca el limite del lienzo
            ctx.strokeStyle = "black"
            ctx.strokeRect(0, 0, 1500, 880);

            //fondo blanco
            ctx.fillStyle = "white";
            ctx.fillRect(1, 1, 1498, 878);

            //dibujar jugador
            ctx.fillStyle = player.c;
            ctx.fillRect(player.x,player.y,player.w,player.h);

            //dibujar jugador
            ctx.fillStyle = enemyTest.c;
            ctx.fillRect(enemyTest.x,enemyTest.y,enemyTest.w,enemyTest.h);

            if (pause){
                ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
                ctx.fillRect(1, 1, 1498, 879);

                ctx.fillStyle = "black";
                ctx.font = "30px Arial";
                ctx.fillText("P A U S A", 725, 350);
            }

            update();
            requestAnimationFrame(dibujar);
        };

        requestAnimationFrame(dibujar);
    </script>
</body>
</html>